---
order: -1
title: 🔥 GDCD组件开发规范
toc: false
---

请不要随便修改 GDCD 组件库，请严格遵循下面的开发规范！

## 基本原则

1. 尽量`不修改` antd 官方的源文件，而是新建一个文件扩展新特性，避免更新官方代码时产生冲突；
2. 新组件要做到与官方组件完全兼容，新增的属性要设置适当的默认值以与官方组件兼容；
3. 官方组件的静态属性和方法，新组件要继续保留；
4. 样式修改，首要考虑使用重写变量的方式，没有变量的可以重写 css 样式，但要保证 css 优先级与官方组件`完全`相同；
5. 扩展的新属性`务必`要更新到组件文档中；
6. 新特性建议同步增加一个 demo 示例；

## 切换分支

只能在 `gdc` 分支上进行开发

## 扩展组件

1. 在 `components/xxx` 目录下，新建一个`gdcd.tsx`（必须是这个名字），作为新组件的入口文件；
2. 在入口文件中导入 `./index`，并导出所有的导出项 `export * from './index'`
3. `export default`默认导出一个新的组件，把官方组件包裹一下，需要使用 `forwardRef` 传递官方组件的引用；
4. 如果官方组件上有挂着静态属性，还需要使用 `copyWithStatic` 方法把静态属性都拷贝过来；
5. 新组件的 Props 要继承自官方组件的 Props 类型，再扩展新属性，扩展的属性要提供完整的 JSDoc 文档，并说明属性默认值；
6. 在 `components/index.tsx` 中找到对应组件，把入口文件改成 `xxx/gdcd.tsx`；

以上步骤的目的是为了保证组件的使用 API 与官方组件保持一致，请参考 `components/table` 组件

7. 在组件 `style` 目录下新建 `gdcd.less`（必须是这个名字），作为组件扩展样式文件
8. 在 `style/index.less` 的底部添加样式引用 `@import './gdcd.less'`，注意务必要引用在官方样式的下方
9. 在 `gdcd.less` 扩展样式中，要参考官方组件的写法，样式要包括站组件的命名空间下。如果要覆盖官方样式，需要先查看官方样式中是否有定义相关变量，如果有则必须使用重写变量的方式！

   - 如果变量定义在组件的 `index.less` 中，则需要在 `gdcd.less` 中重写变量
   - 如果变量定义在主题中(`components/style/themes/default.less`)，则在 `components/style/themes/default.less` 中进行重写

   如果官方组件中没有使用变量，则需要重写 css，但务必要与官方样式保持`完全一致`的优先级规则，样式嵌套层级要与官方组件完全一致，并且仅重写必要的 css rule，不要扩大，也不要保留不变化的 rule。

   如果要提取一些公共扩展 mixin，放在 `components/style/mixins/gdcd/` 下

10. 在组件 `index.zh-CN.md` 中为新属性或新特性撰写开发文档，新属性要同时加到 `API` 列表中，所有新增的内容，要在标题或明显位置添加 🔥 标记，以突出显示
11. 建议为新特性写一个 demo 文件，这样别人可以直观的预览你的新特性，为别人增加很大的便利性。在组件 `demo` 目录下，添加一个 md 新文件，注意文件名要以 `-` 开头，与官方 demo 区分开。扩展 demo 的 `order` 要从 `900` 开始编号，与官方 demo 分开。另外，还要为 demo 文档写一个简洁、明确的标题，同样在标题中要添加 🔥 标记。

最后再强调一遍原则，尽量在新文件中进行功能扩展，尽量不要改动官方的源文件，否则在更新官方库时会出现很多冲突。原则上不修改官方文件，哪怕是发现了 bug！

## 与 cim-web 集成

cim-web 已经把 gdcd 集成到 `cim-web/packages/gdcd` 子库中，项目启动时会自动检查组件库，如果发现新变动，会自动优先编译 gdcd，等编译完成后再继续编译 umi 项目。如果在 cim-web 运行期间修改了 gdcd 组件，也会自动监听到，并启动自动编译，稍等片刻，等 gdcd 编译完成后，会自动热更新，就可以看到变化了，避免了频繁 npm 发包，比较方便。

当提交代码时，需要先进入 `packages/gdcd/` 目录中单独 commit 并 push 子项目，然后进入 cim-web 项目中提交主项目。必须两步走才能避免 `git submodule` 机制出现问题

## Commit Message

我们暂时不要求每次修改都更新 CHANGELOG，因为可能在同步官方新功能时，产生较多代码冲突。所以，请在每次提交时仔细填写提交消息，尽量详细描述修改内容，增加了哪些新属性，做了哪些功能变更，请以官方 changelog 的标准填写提交消息，ps，如果修改内容较长的话，git 提交消息中也是可以换行的...

## 如何同步 antd 新功能？

在 cim-web 项目下运行 `yarn bootstrap`，会更新 gdcd 子库。需要自己手动执行，为了保持功能同步，请平时保持经常更新，并经常看一看 git log。
